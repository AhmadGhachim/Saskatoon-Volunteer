<!DOCTYPE html>
<html>


<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/css/dashboard.css">


<head>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>

</div>

<header id="header">

    <div class="menu-bar">
        <a href="index.html" class="logo">
            <b>Dashboard</b> Volunteer Saskatoon
        </a>
        <div class="button-area">
            <a href="Log_in.html">Admin Logout</a>
        </div>

    </div>


</header>
<body>
<div class = "heading">
    <h2>Staff Table</h2>
</div>

<div class="sbuttons">
    <button onclick="window.location.href='addstaff.html'" type="button" class="button button1">Add Staff</button>
    <button type="button" class="button button2" onclick="removeStaff()">Delete Staff</button>
    <button type="button" class="button button3">Edit Selected Staff</button>
</div>


<table id="staff">
    <tr>
        <th>Name</th>
        <th>Address</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Age</th>
        <th>Department</th>
    </tr>

</table>
<br>
<div class = "heading">
    <h2>Clients Table</h2>
</div>

<div class="sbuttons">
    <button onclick="window.location.href='addclient.html'" type="button" class="button button1">Add Client</button>
    <button type="button" class="button button2">Delete Client</button>
    <button type="button" class="button button3">Edit Selected Client</button>
</div>


<table id="clients">
    <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Address</th>
        <th>Service Food</th>
        <th>Service Shelter</th>
        <th>Service Supplies</th>
    </tr>

</table>
<script>
    const staffTable = document.getElementById("staff");
    const clientsTable = document.getElementById("clients");
    const firebaseConfig = {
        apiKey: "AIzaSyCCYDb16UPC6WEnJc08Jegk026CKVtHykU",
        authDomain: "project-d7d80.firebaseapp.com",
        databaseURL: "https://project-d7d80-default-rtdb.firebaseio.com",
        projectId: "project-d7d80",
        storageBucket: "project-d7d80.appspot.com",
        messagingSenderId: "620442025289",
        appId: "1:620442025289:web:64139d5d8da3f90937ae98"
    };
    firebase.initializeApp(firebaseConfig);
    let firebaseRef = firebase.database();

    // let email = "admin@volunteersask.ca";    // TODO for Ahmad: Code to sign in user, add this to the webpage on log in
    // let password = "admin123456";
    // let auth = firebase.auth();
    // auth.signInWithEmailAndPassword(email, password);

    // firebase.auth().signOut().then(() => {  // TODO for Ahmad: Code to sign out user, add this to the dashboard webpage
    //     // Sign-out successful.
    // }).catch((error) => {
    //     // An error happened.
    // });

    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            let selectedStaffRow = null;
            // Updates table on webpage whenever new entry is added
            firebaseRef.ref("staff").on("value", function (snapshot) {
                staffTable.innerHTML = "<tr> <th>Name</th> <th>Address</th> <th>Email</th> <th>Phone</th> <th>Age</th> <th>Department</th> </tr>";
                snapshot.forEach(function (element) {
                    let newRow = staffTable.insertRow();
                    newRow.id = element.key;
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Name"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Address"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Email"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Phone"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Age"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Department"]));
                    newRow.addEventListener("click", function () {
                        alert("Selected " + newRow.id);
                        selectedClientRow = newRow.id;
                    });
                });
            });

            // TODO for Ahmad: create an interface which asks for inputs from the user
            // TODO for Ahmad: replace with inputs from the webpage, add function call to submit button
            function addStaff() {
                // Adds new entry to the database, can also be used to update entries
                let entryName = "Aakash Thaker";
                let entryAddress = "2956 Preston Ave S";
                let entryEmail = "art602@usask.ca";
                let entryPhone = "1234567890";
                let entryAge = 21;
                let entryDepartment = "Computer Science";

                let staffCount = document.getElementById("staff").rows.length; // returns the number of current entries

                firebase.database().ref("staff/s" + (staffCount + 1)).set({
                    Name: entryName,
                    Address: entryAddress,
                    Email: entryEmail,
                    Phone: entryPhone,
                    Age: entryAge,
                    Department: entryDepartment
                });
            }

            // TODO for Ahmad: create a style (similar to staff table) for clients table
            let selectedClientRow = null;
            // Updates table on webpage whenever new entry is added
            firebaseRef.ref("clients").on("value", function (snapshot) {
                clientsTable.innerHTML = "<tr> <th>Name</th> <th>Email</th> <th>Phone</th> <th>Address</th> <th>Service Food</th> <th>Service Shelter</th> <th>Service Supplies</th> </tr>";
                snapshot.forEach(function (element) {
                    let newRow = clientsTable.insertRow();
                    newRow.id = element.key;
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Name"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Email"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Phone"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["Address"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["ServiceFood"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["ServiceShelter"]));
                    newRow.insertCell(-1).appendChild(document.createTextNode(element.val()["ServiceSupplies"]));
                    newRow.addEventListener("click", function () {
                        alert("Selected " + newRow.id);
                        selectedClientRow = newRow.id;
                    });
                });
            });
              
    // TODO for Ahmad: create an interface which asks for inputs from the user
            // TODO for Ahmad: replace with inputs from the webpage, add function call to submit button
            function addClient() {
                // Adds new entry to the database, can also be used to update entries
                let entryName = document.forms["appointment"]["name"].value;
                let entryEmail = document.forms["appointment"]["email"].value;
                let entryPhone = document.forms["appointment"]["Phone"].value;
                let entryAddress = document.forms["appointment"]["address"].value;
                let entryServiceFood = document.forms["appointment"]["service"].value;
                let entryServiceShelter = document.forms["appointment"]["service"].value;
                let entryServiceSupplies = document.forms["appointment"]["service"].value;

                let clientCount = document.getElementById("client").rows.length; // returns the number of current entries

                firebase.database().ref("clients/c" + (clientCount + 1)).set({
                    Name: entryName,
                    Email: entryEmail,
                    Phone: entryPhone,
                    Address: entryAddress,
                    ServiceFood: entryServiceFood,
                    ServiceShelter: entryServiceShelter,
                    ServiceSupplies: entryServiceSupplies
                });
            }

        }
        else
            alert("Admin not signed in!");
    });

</script>
</body>
</html>
